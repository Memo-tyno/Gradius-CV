<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Gradius Style - player-controls</title>
    <style>
        :root {
            --bg: #000;
            --accent: #0ff;
        }
        body {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg);
            color: var(--accent);
            font-family: "Courier New", monospace;
        }
        #gameContainer { text-align: center; }
        canvas {
            display: block;
            border: 2px solid var(--accent);
            background: linear-gradient(to bottom, #000 0%, #001 50%, #002 100%);
        }
        button {
            margin-top: 10px;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 6px 12px;
            cursor: pointer;
        }
        button:hover {
            background: var(--accent);
            color: #000;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <button id="startBtn">Démarrer le jeu</button>
    </div>

<script>
/* =====================
   Branche: player-controls
   ===================== */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const gameState = {
    running: false,
    score: 0,
    lives: 3,
    player: null,
    enemies: [],
    bullets: [],
    enemyBullets: [],
    stars: [],
    keys: {},
    lastTime: 0,
    enemySpawnTimer: 0,
    lastShot: 0
};

/* ----------- Star ----------- */
class Star {
    constructor() { this.reset(); }
    reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.speed = Math.random() * 2 + 0.5;
        this.size = Math.random() * 2 + 0.3;
    }
    update(dt) {
        this.x -= this.speed * dt * 60;
        if (this.x < -2) this.reset(), this.x = canvas.width + 2;
    }
    draw() {
        ctx.fillStyle = '#fff';
        ctx.fillRect(this.x, this.y, this.size, this.size);
    }
}

/* ----------- Player ----------- */
class Player {
    constructor() {
        this.x = 100;
        this.y = canvas.height / 2;
        this.width = 40;
        this.height = 30;
        this.speed = 5;
    }
    update(dt) {
        if (gameState.keys['ArrowUp'] || gameState.keys['z']) this.y -= this.speed;
        if (gameState.keys['ArrowDown'] || gameState.keys['s']) this.y += this.speed;
        if (gameState.keys['ArrowLeft'] || gameState.keys['q']) this.x -= this.speed;
        if (gameState.keys['ArrowRight'] || gameState.keys['d']) this.x += this.speed;

        // garde le joueur dans l’écran
        this.y = Math.max(this.height/2, Math.min(canvas.height - this.height/2, this.y));
        this.x = Math.max(this.width/2, Math.min(canvas.width - this.width/2, this.x));

        // tir automatique
        const now = Date.now();
        if (now - gameState.lastShot > 200) {
            gameState.bullets.push(new Bullet(this.x + 25, this.y, true));
            gameState.lastShot = now;
        }
    }
    draw() {
        ctx.fillStyle = '#0ff';
        ctx.beginPath();
        ctx.moveTo(this.x + 20, this.y);
        ctx.lineTo(this.x - 20, this.y - 15);
        ctx.lineTo(this.x - 10, this.y);
        ctx.lineTo(this.x - 20, this.y + 15);
        ctx.closePath();
        ctx.fill();
    }
}

/* ----------- Enemy ----------- */
class Enemy {
    constructor() {
        this.x = canvas.width + 50;
        this.y = 50 + Math.random() * (canvas.height - 100);
        this.speed = 2;
    }
    update(dt) {
        this.x -= this.speed * dt * 60;
    }
    draw() {
        ctx.fillStyle = '#f00';
        ctx.fillRect(this.x - 15, this.y - 15, 30, 30);
    }
}

/* ----------- Bullet ----------- */
class Bullet {
    constructor(x, y, isPlayer = true) {
        this.x = x;
        this.y = y;
        this.isPlayer = isPlayer;
        this.speed = isPlayer ? 10 : 5;
    }
    update(dt) { this.x += this.speed * dt * 60; }
    draw() {
        ctx.fillStyle = this.isPlayer ? '#0ff' : '#f00';
        ctx.fillRect(this.x - 5, this.y - 2, 10, 4);
    }
}

/* ----------- Initialisation ----------- */
function initStars(n = 80) {
    gameState.stars = [];
    for (let i = 0; i < n; i++) gameState.stars.push(new Star());
}

/* ----------- Enemy spawn ----------- */
function spawnEnemy() {
    const now = Date.now();
    if (!gameState.enemySpawnTimer) gameState.enemySpawnTimer = now;
    if (now - gameState.enemySpawnTimer < 1500) return;
    gameState.enemySpawnTimer = now;
    gameState.enemies.push(new Enemy());
}

/* ----------- Démarrage ----------- */
function startGame() {
    gameState.running = true;
    gameState.score = 0;
    gameState.lives = 3;
    gameState.player = new Player();
    gameState.enemies = [];
    gameState.bullets = [];
    initStars();
    gameState.lastTime = Date.now();
    requestAnimationFrame(gameLoop);
}

/* ----------- Boucle de jeu ----------- */
function gameLoop() {
    if (!gameState.running) return;
    const now = Date.now();
    const dt = (now - gameState.lastTime) / 1000;
    gameState.lastTime = now;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    gameState.stars.forEach(s => s.update(dt));
    gameState.player.update(dt);
    spawnEnemy();
    gameState.enemies.forEach(e => e.update(dt));
    gameState.bullets.forEach(b => b.update(dt));

    gameState.stars.forEach(s => s.draw());
    gameState.player.draw();
    gameState.enemies.forEach(e => e.draw());
    gameState.bullets.forEach(b => b.draw());

    gameState.bullets = gameState.bullets.filter(b => b.x < canvas.width + 100);

    requestAnimationFrame(gameLoop);
}

/* ----------- Événements clavier ----------- */
window.addEventListener('keydown', e => { gameState.keys[e.key] = true; });
window.addEventListener('keyup', e => { gameState.keys[e.key] = false; });

document.getElementById('startBtn').addEventListener('click', () => {
    if (!gameState.running) startGame();
});
</script>
</body>
</html>
